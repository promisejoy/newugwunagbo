<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Article - Ugwunagbo LGA</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Full News Page Styles */
        .news-detail-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px 0;
        }

        .news-article {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #e8e8e8;
        }

        .news-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .news-title {
            color: #2c3e50;
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .news-meta {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .news-date {
            color: #7f8c8d;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .news-date i {
            color: #3498db;
        }

        .news-image-full {
            margin: 25px 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .news-image-full img {
            width: 100%;
            height: 350px;
            object-fit: cover;
            display: block;
        }

        .news-content-full {
            line-height: 1.7;
            font-size: 1.1rem;
            color: #2c3e50;
        }

        .news-content-full p {
            margin-bottom: 20px;
            text-align: left;
        }

        .news-actions {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .share-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }

        .share-btn:hover {
            background: #e9ecef;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .error {
            text-align: center;
            padding: 40px 20px;
            color: #e74c3c;
            background: #fdf2f2;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
        }

        .error h3 {
            color: #c0392b;
            margin-bottom: 15px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .news-detail-container {
                padding: 15px;
            }

            .news-article {
                padding: 20px;
                margin: 0;
                border-radius: 8px;
            }

            .news-title {
                font-size: 1.8rem;
            }

            .news-image-full {
                margin: 20px 0;
            }

            .news-image-full img {
                height: 250px;
            }

            .news-content-full {
                font-size: 1rem;
                line-height: 1.6;
            }

            .news-actions {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .news-actions .btn {
                text-align: center;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .news-article {
                padding: 15px;
            }

            .news-title {
                font-size: 1.5rem;
            }

            .news-image-full img {
                height: 200px;
            }

            .news-header {
                margin-bottom: 20px;
                padding-bottom: 15px;
            }

            .news-meta {
                flex-direction: column;
                gap: 8px;
            }

            .news-content-full p {
                margin-bottom: 15px;
            }
        }

        /* Loading Animation */
        .fa-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
     <!-- Header -->
    <header>
        <div class="container">
            <div class="header-top">
                <div class="logo">
                    <div class="logo-placeholder">
                        <i class="fas fa-landmark fa-2x" aria-hidden="true"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Ugwunagbo LGA</h1>
                        <p>Abia State, Nigeria</p>
                    </div>
                </div>
                <div class="header-contact-info">
                    <div class="header-contact-item">
                        <i class="fas fa-phone" aria-hidden="true"></i>
                        <span>+234 123 456 7890</span>
                    </div>
                    <div class="header-contact-item">
                        <i class="fas fa-envelope" aria-hidden="true"></i>
                        <span>info@ugwunagbolga.gov.ng</span>
                    </div>
                </div>
                <div class="admin-login">
                    <button class="admin-btn" id="adminLoginBtn">
                        <i class="fas fa-user-shield" aria-hidden="true"></i> Admin
                    </button>
                </div>
            </div>
            <nav>
                <button class="mobile-menu-btn" aria-label="Toggle navigation menu">
                    <i class="fas fa-bars" aria-hidden="true"></i> Menu
                </button>
                <div class="nav-scroll-container">
                    <ul class="nav-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="index.html#about">About Us</a></li>
                        <li data-hide-on-mobile><a href="index.html#leadership">Leadership</a></li>
                        <li><a href="forum.html">Diaspora Forum</a></li>
                        <li><a href="support.html">Support</a></li>
                        <li><a href="events.html">Events</a></li>
                        <li><a href="index.html#news">News</a></li>
                        <li data-hide-on-mobile><a href="index.html#culture">Culture</a></li>
                        <li data-hide-on-mobile><a href="index.html#services">Services</a></li>
                        <li data-hide-on-mobile><a href="index.html#departments">Departments</a></li>
                        <li><a href="index.html#contact">Contact</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="news-detail-container" id="newsDetailContainer">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i> Loading news article...
            </div>
        </div>
        
        <div class="news-actions" style="margin-top: 30px; display: none;" id="newsActions">
            <a href="index.html#news" class="btn btn-outline back-btn">
                <i class="fas fa-arrow-left"></i> Back to News
            </a>
            <button class="btn btn-outline share-btn" id="shareNewsBtn">
                <i class="fas fa-share-alt"></i> Share Article
            </button>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Ugwunagbo LGA</h3>
                    <p>
                        Committed to serving our community with integrity, transparency,
                        and excellence.
                    </p>
                    <div class="social-links">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f" aria-hidden="true"></i></a>
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram" aria-hidden="true"></i></a>
                        <a href="#" aria-label="YouTube"><i class="fab fa-youtube" aria-hidden="true"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                        <li><a href="index.html#about"><i class="fas fa-info-circle"></i> About Us</a></li>
                        <li><a href="index.html#leadership"><i class="fas fa-users"></i> Leadership</a></li>
                        <li><a href="index.html#culture"><i class="fas fa-monument"></i> Culture</a></li>
                        <li><a href="index.html#services"><i class="fas fa-concierge-bell"></i> Services</a></li>
                        <li><a href="index.html#departments"><i class="fas fa-building"></i> Departments</a></li>
                        <li><a href="index.html#news"><i class="fas fa-newspaper"></i> News & Events</a></li>
                        <li><a href="support.html"><i class="fas fa-hands-helping"></i> Support</a></li>
                        <li><a href="forum.html"><i class="fas fa-comments"></i> Diaspora Forum</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Services</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-baby"></i> Birth Registration</a></li>
                        <li><a href="#"><i class="fas fa-money-bill-wave"></i> Revenue Collection</a></li>
                        <li><a href="#"><i class="fas fa-file-contract"></i> Business Permits</a></li>
                        <li><a href="#"><i class="fas fa-clinic-medical"></i> Health Services</a></li>
                        <li><a href="#"><i class="fas fa-hand-holding-heart"></i> Social Welfare</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact Info</h3>
                    <ul class="footer-links">
                        <li>
                            <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                            Ugwunagbo LGA Secretariat
                        </li>
                        <li>
                            <i class="fas fa-phone" aria-hidden="true"></i> +234 123 456 7890
                        </li>
                        <li>
                            <i class="fas fa-envelope" aria-hidden="true"></i>
                            info@ugwunagbolga.gov.ng
                        </li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>Courtesy Of SmartDevTechs</p>
                <p>
                    &copy; <span id="currentYear"></span> Ugwunagbo Local Government
                    Area. All Rights Reserved.
                </p>
            </div>
        </div>
    </footer>

    <button class="scroll-to-top" id="scrollToTop" aria-label="Scroll to top">
        <i class="fas fa-chevron-up" aria-hidden="true"></i>
    </button>
    
    <script>
        // Initialize the news detail page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('News detail page loaded');
            
            // Initialize mobile menu
            initializeMobileMenu();
            
            // Initialize scroll to top
            initializeScrollToTop();
            
            // Set current year in footer
            document.getElementById("currentYear").textContent = new Date().getFullYear();
            
            // Get news ID from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const newsId = urlParams.get('id');
            
            if (newsId) {
                console.log('Loading news article with ID:', newsId);
                loadSingleNews(newsId);
            } else {
                showError('No news article specified. Please go back and select a news article.');
            }
            
            // Initialize share button
            document.getElementById('shareNewsBtn').addEventListener('click', shareNews);
        });

        // Mobile Menu Functionality
        function initializeMobileMenu() {
            const mobileMenuBtn = document.querySelector(".mobile-menu-btn");
            const navLinks = document.querySelector(".nav-links");

            if (mobileMenuBtn && navLinks) {
                mobileMenuBtn.addEventListener("click", function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    navLinks.classList.toggle("active");
                    const isExpanded = navLinks.classList.contains("active");
                    this.setAttribute("aria-expanded", isExpanded.toString());
                });

                // Close mobile menu when clicking on a link
                const navItems = navLinks.querySelectorAll("a");
                navItems.forEach((item) => {
                    item.addEventListener("click", () => {
                        navLinks.classList.remove("active");
                        mobileMenuBtn.setAttribute("aria-expanded", "false");
                    });
                });

                // Close mobile menu when clicking outside
                document.addEventListener("click", function(event) {
                    if (!event.target.closest("nav") && navLinks.classList.contains("active")) {
                        navLinks.classList.remove("active");
                        mobileMenuBtn.setAttribute("aria-expanded", "false");
                    }
                });

                // Close on escape key
                document.addEventListener("keydown", function(event) {
                    if (event.key === "Escape" && navLinks.classList.contains("active")) {
                        navLinks.classList.remove("active");
                        mobileMenuBtn.setAttribute("aria-expanded", "false");
                    }
                });
            }
        }

        // Scroll to Top Functionality
        function initializeScrollToTop() {
            const scrollToTopBtn = document.getElementById("scrollToTop");

            if (scrollToTopBtn) {
                scrollToTopBtn.style.display = "none";

                window.addEventListener("scroll", () => {
                    if (window.pageYOffset > 300) {
                        scrollToTopBtn.style.display = "block";
                        scrollToTopBtn.classList.add("show");
                    } else {
                        scrollToTopBtn.style.display = "none";
                        scrollToTopBtn.classList.remove("show");
                    }
                });

                scrollToTopBtn.addEventListener("click", () => {
                    window.scrollTo({
                        top: 0,
                        behavior: "smooth",
                    });
                });
            }
        }

        // Load single news article - FIXED VERSION
        async function loadSingleNews(newsId) {
            const container = document.getElementById('newsDetailContainer');
            
            try {
                console.log('ðŸ”„ Fetching all news articles to find:', newsId);
                
                // First, get all news articles
                const response = await fetch('/api/news');
                
                if (!response.ok) {
                    throw new Error(`Failed to fetch news: ${response.status}`);
                }
                
                const allNews = await response.json();
                console.log('ðŸ“° All news articles:', allNews);
                
                // Find the specific news article by ID
                const newsItem = allNews.find(item => 
                    item._id === newsId || item.id === newsId
                );
                
                if (newsItem) {
                    console.log('âœ… Found news article:', newsItem);
                    displaySingleNews(newsItem);
                } else {
                    console.log('âŒ News article not found. Available IDs:', allNews.map(item => item._id || item.id));
                    showError(`News article not found. Available articles: ${allNews.length}`);
                }
                
            } catch (error) {
                console.error('âŒ Error loading news article:', error);
                showError(`Error loading news article: ${error.message}`);
            }
        }

        // Display single news article
        function displaySingleNews(newsItem) {
            const container = document.getElementById('newsDetailContainer');
            const newsActions = document.getElementById('newsActions');
            
            // Handle image URL
            let imageUrl = "https://images.unsplash.com/photo-1585829365295-ab7cd400c167?ixlib=rb-4.0.3&auto=format&fit=crop&w=1170&q=80";
            
            if (newsItem.image) {
                if (newsItem.image.startsWith("http")) {
                    imageUrl = newsItem.image;
                } else if (newsItem.image.startsWith("/")) {
                    imageUrl = window.location.origin + newsItem.image;
                } else {
                    imageUrl = window.location.origin + '/' + newsItem.image;
                }
            }

            // Handle content
            let contentHTML = '';
            if (typeof newsItem.content === 'string') {
                contentHTML = newsItem.content.split('\n').map(paragraph => 
                    paragraph.trim() ? `<p>${paragraph.trim()}</p>` : ''
                ).join('');
            } else {
                contentHTML = '<p>No content available.</p>';
            }

            const newsHTML = `
                <article class="news-article">
                    <div class="news-header">
                        <h1 class="news-title">${newsItem.title || 'Untitled Article'}</h1>
                        <div class="news-meta">
                            <span class="news-date">
                                <i class="fas fa-calendar-alt"></i>
                                ${formatDate(newsItem.date || new Date().toISOString())}
                            </span>
                        </div>
                    </div>
                    
                    <div class="news-image-full">
                        <img src="${imageUrl}" alt="${newsItem.title || 'News Image'}" loading="lazy">
                    </div>
                    
                    <div class="news-content-full">
                        ${contentHTML}
                    </div>
                </article>
            `;

            container.innerHTML = newsHTML;
            newsActions.style.display = 'flex';
            
            // Update page title
            document.title = `${newsItem.title} - Ugwunagbo LGA`;
        }

        // Show error message
        function showError(message) {
            const container = document.getElementById('newsDetailContainer');
            container.innerHTML = `
                <div class="error">
                    <h3><i class="fas fa-exclamation-triangle"></i> Unable to Load Article</h3>
                    <p>${message}</p>
                    <div style="margin-top: 20px;">
                        <a href="index.html#news" class="btn btn-primary">
                            <i class="fas fa-arrow-left"></i> Back to News
                        </a>
                    </div>
                </div>
            `;
        }

        // Share news function
        function shareNews() {
            const title = document.querySelector('.news-title')?.textContent || 'News Article';
            const url = window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: title,
                    text: `Check out this news from Ugwunagbo LGA: ${title}`,
                    url: url
                })
                .then(() => console.log('News shared successfully'))
                .catch(error => console.log('Error sharing news:', error));
            } else {
                // Fallback: copy to clipboard
                const tempInput = document.createElement('input');
                tempInput.value = `${title} - ${url}`;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                
                // Show temporary feedback
                const shareBtn = document.getElementById('shareNewsBtn');
                const originalText = shareBtn.innerHTML;
                shareBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                shareBtn.disabled = true;
                
                setTimeout(() => {
                    shareBtn.innerHTML = originalText;
                    shareBtn.disabled = false;
                }, 2000);
            }
        }

        // Format date function
        function formatDate(dateString) {
            try {
                const options = { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric'
                };
                return new Date(dateString).toLocaleDateString('en-US', options);
            } catch (error) {
                return 'Date not available';
            }
        }

        // Debug function to check what's happening
        function debugNews() {
            const urlParams = new URLSearchParams(window.location.search);
            const newsId = urlParams.get('id');
            console.log('ðŸ” Debug Info:');
            console.log('URL News ID:', newsId);
            console.log('Current URL:', window.location.href);
            
            fetch('/api/news')
                .then(response => response.json())
                .then(data => {
                    console.log('All news from API:', data);
                    console.log('Available IDs:', data.map(item => item._id || item.id));
                })
                .catch(error => console.error('Debug fetch error:', error));
        }

        // Uncomment to debug
        debugNews();
    </script>
</body>
</html>